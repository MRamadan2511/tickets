{% extends "base.html" %}
{% load crispy_forms_tags %}
{% comment %} {% block header_icon %}<i class="fa fa-pencil-square-o fa-5x"></i>{% endblock %} {% endcomment %}
{% comment %} {% block headline %}Ticket #{{ticket.id}}{% endblock %} {% endcomment %}
{% comment %} {% block head-message %}Everything you need to know about this ticket{% endblock %} {% endcomment %}

{% block title %}Tickets - Details of ticket {{ ticket.id }}{% endblock %}

{% block content %}


      <div class="pt-3 page-header text-center"><h1>Ticket # {{ ticket.id }}</h1>
       
      </div>

<div class="row">
<div class="col-lg-2 border-right">
    <form method="POST" id="my-form" >
      {% csrf_token %}
      
        {% comment %} Warehous List Start {% endcomment %}
       <p>Warehous:</p>
       {% if request.user.is_wh_manager or request.user.is_superuser  %}
            <select name="warehouse"  id="warehouse-select" class="form-select" >
              {% for ware in wh_list %}
              <option value="{{ ware.0 }}" {% if ticket.warehouse == ware.0 %}selected{% endif %}>
                {{ ware.1 }}
              </option>
              {% endfor %}
    
            </select>
       {% else %}
       <p class="mt-2">{{ ticket.warehouse  }}</p>
       {% endif %}
       <hr style="height:5px; border:1px;  background-color:Silver"> 
{% comment %} Warehous List End {% endcomment %}

{% comment %} Team Tag Start {% endcomment %}
          <p class="mt-2">Tag To:</p>

          {% if request.user.is_superuser or request.user.is_team_leader or request.user.is_wh_manager%}
            <select name="tag_to"  id="tag-select" class="form-select" >
              {% for tag in team_tag_list %} 
              <option value="{{ tag.0 }}" {% if ticket.tag_to == tag.0 %}selected{% endif %}>
                {{ tag.1 }}
              </option>
              {% endfor %}
    
            </select>
          {% else %}
          <p class="mt-2">{{ ticket.tag_to  }}</p>
          {% endif %}

{% comment %} Team Tag End {% endcomment %}
          
            <button type="submit" class="mt-3 mx-auto btn btn-primary btn-md save-btn d-none">Save Edits</button>
        
    </form>

    <script>
      $(document).ready(function() {
        $('#warehouse-select, #tag-select').change(function() {
          $('.save-btn').removeClass('d-none'); // show the submit button
          });
        });
      
</script>
   <hr style="height:5px; border:1px;  background-color:Silver"> 
</div>

<div class="col-lg-1">
  
</div>
    <div class="col-lg-8">

<table class="table table-bordered table-hover">
  <tr>
    <td class="description"><b>Status</b></td>
    <td>{{ticket.status}}
      {% comment %} <span class="label label-danger">TODO</span>{% elif ticket.status == "DONE" %}<span class="label label-success">DONE</span>{% elif ticket.status == "WAITING" %}<span class="label label-warning">WAITING</span>{% elif ticket.status == "IN PROGRESS" %}<span class="label label-default">IN PROGRESS</span>{% endif %}</td> {% endcomment %}
  </tr>
  <tr>
    <td class="description"><b>Assigned to</b></td>
    <td>{% if ticket.assigned_to %}{{ ticket.assigned_to.first_name }} {{ ticket.assigned_to.last_name }}{% else %}---{% endif %}</td>
  </tr>
  <tr>
    <td class="description"><b>Created By</b></td>
    <td>{{ ticket.owner }}</td>
  </tr>
  <tr>
    <td width="180px" class="description"><b>Order ID</b></td>
    <td>{{ ticket.order_id }}</td>
  </tr>

 
  {% comment %} {% if request.user.is_wh_manager  %}
  <tr>
    <td width="180px" class="description"><b>Warehous</b></td>
    <td>{{ ticket.warehouse }}</td>
  </tr>
  {% endif %} {% endcomment %}
  <tr>
    <td width="180px" class="description"><b>Created At</b></td>
    <td> {{ ticket.created }}</td>
  </tr>
  {% if ticket.post_image%}
  <tr>
    <td class=""><b>Attachments</b></td>
    <td> <a href="{{ticket.post_image.url}}" target="_blank"><p>Attched File</p></a></td>
  </tr>
  {% endif %}
  <tr>
    <td class="description"><b>Description</b></td>
    <td>{{ ticket.description}}</td>
  </tr>

</table>

    </div>
    <hr style="height:5px; border:1px;  background-color:Silver">
    <div class="col-lg-4">

{% comment %} {% if attachments %}
<h2>Attachments</h2>
<ul>
    {% for attachment in attachments %}
    <li><a href="/media/tickets/{{ ticket.id }}/{{ attachment.filename }}">{{ attachment.filename }}</a></li>
    {% endfor %}
</ul>
{% endif %} {% endcomment %}

    </div><!-- Ende column -->
</div><!-- Ende row -->

<div class="card-body">
  <div class="comments" style="padding: 10px;">
    {% for comment in comments %}
    {% comment %}  style="background-color:{% cycle 'White' 'Silver' as bgcolor %}" {% endcomment %}
    <div class="text-end">
      <span class="text-end text-muted font-weight-normal" >
          {% if comment.user == user %}
            You Added Comment @  <small > {{ comment.created }}</small>
          {% else %}
            {{ comment.user }}  Added Comment  @  <small > {{ comment.created }}</small>
        </span>
          {% endif %}
      <p class="text-end pt-3 ">
        {{ comment.comment }}
      </p>
      {% if comment.comment_image%}
      <a   href="{{comment.comment_image.url}}" target="_blank"> <p class="text-end ">Attched File</p></a>
      {% endif %}
      <hr style="height:5px; border: 1px;  background-color:Silver">
      
    </div>

    
    {% endfor %}
  </div>

<div>
    <h3 class="text-center">Add a comment</h3>
    
    <form method="POST" style="margin-top: 1.3em;" enctype="multipart/form-data">
      {% csrf_token %}
      {{ comment_form | crispy }}
      
      <button type="submit" class="btn btn-primary  btn-lg">Submit</button>
    </form>
  </div>

{% endblock %}

